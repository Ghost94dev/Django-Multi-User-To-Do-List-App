{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Todo</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <script src="https://kit.fontawesome.com/cb792c0850.js" crossorigin="anonymous"></script>
</head>
<body>

    <div class="theme-toggle-container">
        <button id="theme-toggle" class="theme-toggle-btn">
            <i class="fa-solid fa-moon"></i>
        </button>
    </div>

    <div class="logout-container">
        {% if user.is_authenticated %}
            <form action="{% url 'todo:logout' %}" method="post">
                {% csrf_token %}
                <button type="submit" class="logout-button" title="Logout">
                    <i class="fa-solid fa-right-from-bracket logout-icon"></i>
                </button>
             </form>
        {% else %}
              <a href="{% url 'todo:login' %}" class="login-btn"> Login </a>
        {%endif %}
    </div>

    <div class="signup-login">
        <div class="signup-box">
            <h3 class="user-greeting">Hello {{ user }}</h3>

            <h2>Get Things Done?</h2>

            <form method="post">
                {% csrf_token %}
                <input type="text" class="inp" name="title" required placeholder="Add Today's Task?">

                <!-- CATEGORY SELECTOR -->
                <div class="field">
                    <select name="category" class="inp" required>
                        <option value="" selected disabled>Select Category</option>
                        {% for cat in categories %}
                        <option value="{{ cat.id }}" style="color: white;">{{ cat.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <!-- New due date field -->
                <div class="field">
                    <input type="datetime-local" class="inp" name="due_date">
                </div>

                <input type="submit" class="submit-button" value="Add Task">
            </form>

            <div class="task-container">
                {% for todo in res %}
                <div class="task-list">
                    <div class="task-left">
                        <span class="task-id">{{ todo.srno }}</span>
                        <span class="task-title">{{ todo.title }}</span>
                        {% if todo.category %}
                        <span class="category-badge" style="background-color: {{ todo.category.color }}">
                            {{ todo.category.name }}
                        </span>
                        {% endif %}
                    </div>
                    <div class="task-actions">
                        <a href="{% url 'todo:edit_task' srno=todo.srno %}"><i class="fa-solid fa-pen"></i></a>
                        <a href="{% url 'todo:delete_task' srno=todo.srno %}"><i class="fa-solid fa-trash"></i></a>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

      <script>
        const themeToggle = document.getElementById('theme-toggle');
        const html = document.documentElement;
        const icon = themeToggle.querySelector('i');

        // Check for saved theme preference
        const savedTheme = localStorage.getItem('theme') || 'light';
        html.setAttribute('data-theme', savedTheme);

        // Set initial icon
        if (savedTheme === 'dark') {
            icon.classList.replace('fa-moon', 'fa-sun');
        }

        themeToggle.addEventListener('click', () => {
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';

            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);

            // Toggle icon
            if (newTheme === 'dark') {
                icon.classList.replace('fa-moon', 'fa-sun');
            } else {
                icon.classList.replace('fa-sun', 'fa-moon');
            }
        });
    </script>
</body>
</html>
