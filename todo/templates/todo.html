{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Todo - {{ user.username }}</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <script src="https://kit.fontawesome.com/cb792c0850.js" crossorigin="anonymous"></script>
</head>
<body>

    <div class="theme-toggle-container">
        <button id="theme-toggle" class="theme-toggle-btn">
            <i class="fa-solid fa-moon"></i>
        </button>
    </div>

    <div class="logout-container">
        {% if user.is_authenticated %}
            <form action="{% url 'todo:logout' %}" method="post">
                {% csrf_token %}
                <button type="submit" class="logout-button" title="Logout">
                    <i class="fa-solid fa-right-from-bracket logout-icon"></i>
                    Logout
                </button>
             </form>
        {% else %}
              <a href="{% url 'todo:login' %}" class="login-btn"> Login </a>
        {%endif %}
    </div>

    <div class="signup-login">
        <div class="signup-box">
            <!-- Motivational Header -->
            <div class="motivational-header">
                <h1>Welcome back, {{ user.username }}! ðŸ‘‹</h1>
                <p class="motivational-quote" id="motivationalQuote">
                    "The secret of getting ahead is getting started." - Mark Twain
                </p>
            </div>

            <h2>Get Things Done</h2>

            <form method="post">
                {% csrf_token %}
                <input type="text" class="inp" name="title" required placeholder="Add Today's Task?">

                <!-- CATEGORY SELECTOR -->
                <div class="field">
                    <select name="category" class="inp" required>
                        <option value="" selected disabled>Select Category</option>
                        {% for cat in categories %}
                        <option value="{{ cat.id }}">{{ cat.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <!-- New due date field -->
                <div class="field">
                    <input type="datetime-local" class="inp" name="due_date">
                </div>

                <input type="submit" class="submit-button" value="Add Task">
            </form>

            <div class="task-container">
                {% for todo in res %}
                <div class="task-list">
                    <div class="task-left">
                        <span class="task-id">{{ todo.srno }}</span>
                        <span class="task-title">{{ todo.title }}</span>
                        {% if todo.category %}
                        <span class="category-badge" style="background-color: {{ todo.category.color }}">
                            {{ todo.category.name }}
                        </span>
                        {% endif %}
                    </div>
                    <div class="task-actions">
                        <a href="{% url 'todo:edit_task' srno=todo.srno %}"><i class="fa-solid fa-pen"></i></a>
                        <a href="{% url 'todo:delete_task' srno=todo.srno %}"><i class="fa-solid fa-trash"></i></a>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <script>
        const themeToggle = document.getElementById('theme-toggle');
        const html = document.documentElement;
        const icon = themeToggle.querySelector('i');

        // Check for saved theme preference
        const savedTheme = localStorage.getItem('theme') || 'light';
        html.setAttribute('data-theme', savedTheme);

        // Set initial icon
        if (savedTheme === 'dark') {
            icon.classList.replace('fa-moon', 'fa-sun');
        }

        themeToggle.addEventListener('click', () => {
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';

            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);

            // Toggle icon
            if (newTheme === 'dark') {
                icon.classList.replace('fa-moon', 'fa-sun');
            } else {
                icon.classList.replace('fa-sun', 'fa-moon');
            }
        });

        const quotes = [
            "Productivity is never an accident. It is always the result of a commitment to excellence, intelligent planning, and focused effort.",
            "Your time is limited, so don't waste it living someone else's life.",
            "The way to get started is to quit talking and begin doing.",
            "It's not about having time, it's about making time.",
            "Small daily improvements are the key to staggering long-term results.",
            "Focus on being productive instead of busy.",
            "Your future is created by what you do today, not tomorrow."
        ];

        document.getElementById('motivationalQuote').textContent =
            '"' + quotes[Math.floor(Math.random() * quotes.length)] + '"';
    </script>
</body>
</html>